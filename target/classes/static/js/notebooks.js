const apiNotebooks = '/api/notebooks';
async function listarNotebooks(){ const res=await fetch(apiNotebooks); const data=await res.json(); const tbody=document.querySelector('#tblNotebooks tbody'); tbody.innerHTML=''; data.forEach(n=>{ const cliente = n.cliente ? n.cliente.nome : ''; const tr=document.createElement('tr'); tr.innerHTML=`<td>${n.id}</td><td>${cliente}</td><td>${n.marca||''}</td><td>${n.modelo||''}</td><td>${n.serial||''}</td><td><button onclick="excluir(${n.id})">Excluir</button></td>`; tbody.appendChild(tr); }); }
async function carregarClientes(){ const r=await fetch('/api/clientes'); const d=await r.json(); const sel=document.getElementById('clienteSelect'); if(!sel) return; sel.innerHTML=''; d.forEach(c=> sel.insertAdjacentHTML('beforeend', `<option value="${c.id}">${c.nome}</option>`)); }
async function salvarNotebook(e){ e.preventDefault(); const fd=new FormData(e.target); const obj=Object.fromEntries(fd.entries()); if(!obj.clienteId){ alert('Selecione cliente'); return;} obj.cliente={id:Number(obj.clienteId)}; delete obj.clienteId; await fetch(apiNotebooks,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(obj)}); window.location='/notebooks-listar.html'; }
async function excluir(id){ if(!confirm('Excluir?')) return; await fetch(apiNotebooks+'/'+id,{method:'DELETE'}); listarNotebooks(); }
document.addEventListener('DOMContentLoaded',()=>{ if(document.querySelector('#tblNotebooks')) listarNotebooks(); if(document.getElementById('clienteSelect')) carregarClientes(); const f=document.querySelector('#frmNotebook'); if(f) f.addEventListener('submit', salvarNotebook); });
